<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="format-detection" content="telephone=no" />
  <meta name="viewport" content="width=device-width, user-scalable=no,
initial-scale=1, maximum-scale=1, minimum-scale=1" />
  <meta http-equiv="pragma" content="no-cache" />
  <meta http-equiv="expires" content="-1" />

  <title>Rumsappen</title>
      
  <!--<link rel="stylesheet" href="lib/mdl/material.css" />-->
      
  <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://code.getmdl.io/1.1.3/material.indigo-pink.min.css">

  <style>
  .evo-page-content
  {
    margin: 10px 10px;
  }
  .evo-event-item
  {
    width: 300px;
    padding: 5px;
  }
  .evo-place-info
  {
  }
  .evo-place-info-heading
  {
    font-size: 36px;
    padding: 25px 20px;
    color: #ffffff;
  }
  .evo-time-15m
  {
    height: 20px;
  }
  .evo-time-30m
  {
    height: 40px;
  }
  .evo-time-1h
  {
    height: 80px;
  }
  .evo-time-2h
  {
    height: 160px;
  }
  .evo-time-5h
  {
    height: 400px;
  }
  .evo-time-9h
  {
    height: 720px;
  }
  .evo-color-1
  {
    background: #cddc40;
  }
  .evo-color-2
  {
    background: #8bc34a;
  }
  .evo-color-3
  {
    background: #009688;
  }
  .evo-color-4
  {
    background: #00bcd4;
  }
  .evo-color-5
  {
    background: #039af4;
  }
  .evo-color-6
  {
    background: #3f51b5;
  }
  .evo-event-item-duration
  {
    float: right;
  }
  </style>
    
  <script>
  // Redirect console if running from Evothings Workbench.
  if (window.hyper) { console.log = hyper.log }
  </script>
</head>

<body>
    
<!-- Always shows a header, even in smaller screens. -->
<div class="mdl-layout mdl-js-layout mdl-layout--fixed-header">

  <!-- Header -->
  <header class="mdl-layout__header">
    <div class="mdl-layout-icon"></div>
    <div class="mdl-layout__header-row">
      <!-- Title -->
      <span class="mdl-layout-title">Rumsappen</span>
    </div>
    
    <!-- Tabs -->
    <div class="mdl-layout__tab-bar mdl-js-ripple-effect">
      <a id="a-tab-1" href="#tab-1" class="mdl-layout__tab is-active">Info</a>
      <a id="a-tab-2" href="#tab-2" class="mdl-layout__tab">Kök</a>
      <a id="a-tab-3" href="#tab-3" class="mdl-layout__tab">Vardagsrum</a>
      <a id="a-tab-4" href="#tab-4" class="mdl-layout__tab">Sovrum</a>
    </div>
  </header>
  
  <!-- Drawer -->
  <div class="mdl-layout__drawer">
    <span class="mdl-layout__title">Meny</span>
    <nav class="mdl-navigation">
      <a id="show-about-dialog" class="mdl-navigation__link" href="javascript:void(0);">Om appen</a>
      <a id="show-settings-dialog" class="mdl-navigation__link" href="javascript:void(0);">Inställningar</a>
    </nav>
  </div>
  
  <!-- About Dialog -->
  <!-- Not Working
  <dialog id="about-dialog" class="mdl-dialog">
    <h4 class="mdl-dialog__title">Om Nuappen</h4>
    <div class="mdl-dialog__content">
      <p>
        Skiss för app för att hålla reda på vad som ska göras i bostaden (och/eller på andra platser).
      </p>
      <p>
        2016 Evothings AB
      </p>
    </div>
    <div class="mdl-dialog__actions">
      <button type="button" class="mdl-button close">OK</button>
    </div>
  </dialog>
  -->
  
  <!-- Main -->
  <main class="mdl-layout__content">
  
    <!-- tab-1 -->
    <section class="mdl-layout__tab-panel is-active" id="tab-1">
     
      <div class="page-content evo-place-info evo-place-info-0">
        <div class="evo-place-info-heading evo-color-5">Letar...</div>
        <div class="evo-page-content">
          <p>
            Gå till en plats där det finns en beacon.
          </p>
        </div>
      </div>
      
    </section>
    
    <!-- tab-2 -->
    <section class="mdl-layout__tab-panel" id="tab-2">

      <div class="page-content evo-place-info evo-place-info-1">
        <div class="evo-place-info-heading evo-color-5">Köket</div>
        <ul class="demo-list-control mdl-list">
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Göra mellanmål
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Laga middag
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Förbereda frukost
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Diska
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Recept
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Inköpslista
            </span>
          </li>
        </ul>
      </div>
      
    </section>
    
    <!-- tab-3 -->
    <section class="mdl-layout__tab-panel" id="tab-3">
    
      <div class="page-content evo-place-info evo-place-info-2">
        <div class="evo-place-info-heading evo-color-5">Vardagsrummet</div>
        <ul class="demo-list-control mdl-list">
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Göra läxor
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Rita
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Spela
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Modellbygge
            </span>
          </li>
        </ul>
      </div>
        
    </section>
    
    <!-- tab-4 -->
    <section class="mdl-layout__tab-panel" id="tab-4">
    
      <div class="page-content evo-place-info evo-place-info-3">
        <div class="evo-place-info-heading evo-color-5">Sovrummet</div>
        <ul class="demo-list-control mdl-list">
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Bädda
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Vädra
            </span>
          </li>
          <li class="mdl-list__item">
            <span class="mdl-list__item-primary-content">
              Meditera
            </span>
          </li>
        </ul>
      </div>
      
    </section>
    
  </main>
</div>

<!--
<div class="mdl-grid">
  <div class="mdl-cell mdl-cell--6-col mdl-cell--8-col-tablet">
    <h1>Hello World</h1>
    <p>hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd hksa hkasd </p>
<button id="laddaom" value="yes" 
onClick="location.reload();" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">Reset</button></div>
</div>
    <h1>Hello World</h1>
<button id="laddaom" value="yes" 
onClick="location.reload();" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent">Reset</button>
</div>
-->

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
<!--<script src="lib/mdl/material.js"></script>-->
<script src="https://code.getmdl.io/1.1.3/material.min.js"></script>

<script src="cordova.js"></script>

<script>

// Show a tab.
function selectTab(tabId) { $(tabId).get(0).click() }

// Beacon code.

// Application object.
var app = {}

// Regions that define which page to show for each beacon.
app.beaconRegions =
[
	{
		id: 'tab-2',
		uuid:'B9407F30-F5F8-466E-AFF9-25556B57FE6D',
		major: 23271,
		minor: 16990
	},
	{
		id: 'tab-3',
		uuid:'B9407F30-F5F8-466E-AFF9-25556B57FE6D',
		major: 43839,
		minor: 51056
	},
	{
		id: 'tab-4',
		uuid:'B9407F30-F5F8-466E-AFF9-25556B57FE6D',
		major: 46847,
		minor: 33121
	}
]

// Default page if out of range page.
app.infoPage = 'tab-1'

// Currently displayed page.
app.currentPage = app.infoPage

// Currently displayed page time stamp.
app.currentPageTimeStamp = Date.now()

// Timeout for current beacon.
app.currentPageTimeout = 10000

app.initialize = function()
{
	document.addEventListener(
		'deviceready',
		app.onDeviceReady,
		false)
	app.gotoPage(app.infoPage)
	
	// Timeout handler. Shows the info page
	// if no beacons are in range.
	setTimeout(
	    function() 
	    {
	        var now = Date.now()
	        if (now > app.currentPageTimeStamp + app.currentPageTimeout)
	        {
	            app.gotoPage(app.infoPage)
	        }
	    },
	    5000)
}

// Called when Cordova are plugins initialised,
// the iBeacon API is now available.
app.onDeviceReady = function()
{
	// Specify a shortcut for the location manager that
	// has the iBeacon functions.
	window.locationManager = cordova.plugins.locationManager

	// Start tracking beacons!
	app.startScanForBeacons()
}

app.startScanForBeacons = function()
{
	//console.log('startScanForBeacons')

	// The delegate object contains iBeacon callback functions.
	var delegate = new cordova.plugins.locationManager.Delegate()

	delegate.didDetermineStateForRegion = function(pluginResult)
	{
		//console.log('didDetermineStateForRegion: ' + JSON.stringify(pluginResult))
	}

	delegate.didStartMonitoringForRegion = function(pluginResult)
	{
		//console.log('didStartMonitoringForRegion:' + JSON.stringify(pluginResult))
	}

	delegate.didRangeBeaconsInRegion = function(pluginResult)
	{
		//console.log('didRangeBeaconsInRegion: ' + JSON.stringify(pluginResult))
		app.didRangeBeaconsInRegion(pluginResult)
	}

	// Set the delegate object to use.
	locationManager.setDelegate(delegate)

	// Start monitoring and ranging our beacons.
	for (var r in app.beaconRegions)
	{
		var region = app.beaconRegions[r]

		var beaconRegion = new locationManager.BeaconRegion(
			region.id, region.uuid, region.major, region.minor)

		// Start monitoring.
		locationManager.startMonitoringForRegion(beaconRegion)
			.fail(console.error)
			.done()

		// Start ranging.
		locationManager.startRangingBeaconsInRegion(beaconRegion)
			.fail(console.error)
			.done()
	}
}

// Display pages depending of which beacon is close.
app.didRangeBeaconsInRegion = function(pluginResult)
{
	//console.log('numbeacons in region: ' + pluginResult.beacons.length)

	// There must be a beacon within range.
	if (0 == pluginResult.beacons.length)
	{
		return
	}

	// Our regions are defined so that there is one beacon per region.
	// Get the first (and only) beacon in range in the region.
	var beacon = pluginResult.beacons[0]

	// The region identifier is the page id.
	var pageId = pluginResult.region.identifier

	//console.log('@@@@@@@@@@@ ranged beacon: ' + pageId + ' ' + beacon.proximity)
	
	// Show the beacon if it represents a new place.
	if (app.currentPage == app.infoPage)
	{
	    if (beacon.proximity == 'ProximityImmediate' || beacon.proximity == 'ProximityNear')
	    {
		    app.gotoPage(pageId)
		    return
	    }
	}
	
	// If this is the current page and beacon is far go to info page.
	if (app.currentPage == pageId)
	{
	    if (beacon.proximity == 'ProximityFar')
	    {
		    app.gotoPage(app.infoPage)
		    return
	    }
	}
}

app.gotoPage = function(pageId)
{
    //console.log('*********** show beacon ' + pageId)
	app.currentPage = pageId
    app.currentPageTimeStamp = Date.now()
	selectTab('#a-' + pageId)
}

/*
// Functions not used (from Relax Beacons App).

app.gotoPage = function(pageId)
{
	app.hidePage(app.currentPage)
	app.showPage(pageId)
	app.currentPage = pageId
}

app.showPage = function(pageId)
{
	document.getElementById(pageId).style.display = 'block'
}

app.hidePage = function(pageId)
{
	document.getElementById(pageId).style.display = 'none'
}
*/

// Set up the application.
app.initialize()


/* Not working!

var dialog = document.querySelector('#about-dialog');
var showDialogButton = document.querySelector('#show-about-dialog');
if (! dialog.showModal) {
  dialogPolyfill.registerDialog(dialog);
}
showDialogButton.addEventListener('click', function() {
  dialog.showModal();
});
dialog.querySelector('.close').addEventListener('click', function() {
  dialog.close();
});
*/
    
</script>
    

</body>
</html>
